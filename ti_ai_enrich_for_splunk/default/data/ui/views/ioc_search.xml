<form version="1.1" theme="dark">
  <label>IOC Hits on My Network</label>
  <description>Enter one or more IOCs (comma‑delimited) to search across your Splunk indexes. 
    This will return counts and time ranges of any matches observed in your environment.</description>
  <fieldset submitButton="true">
    <input type="text" token="ioc" searchWhenChanged="true">
      <label>IOCs (comma‑delimited)</label>
    </input>
    <input type="time" token="timerange">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <div>
          
          <p>Provide IOCs separated by commas (e.g. <code>1.2.3.4, bad.com, http://malicious[.]site</code>). 
          The dashboard will search for any hits across your indexed data.</p>
        </div>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>IOC Hits by Index</title>
      <table>
        <search>
          <query>| tstats count earliest(_time) as earliest_epoch latest(_time) as latest_epoch where index=* 
              [| makeresults 
              | eval data="$ioc$" 
              | makemv delim="," data 
              | eval data=mvmap(data,"TERM(".data.")") 
              | eval command=mvjoin(data," OR ") 
              | return $command ]
            by index, sourcetype
            | eval earliest=strftime(earliest_epoch,"%Y-%m-%d %H:%M:%S") 
            | eval latest=strftime(latest_epoch,"%Y-%m-%d %H:%M:%S") 
            | eval latest_epoch=if(latest_epoch=earliest_epoch,latest_epoch+1,latest_epoch) 
            | eval earliest_epoch=earliest_epoch-1 
            | eval filter=
              [| makeresults 
              | eval data="$ioc$" 
              | makemv delim="," data 
              | eval data=mvmap(data,"TERM(".data.")") 
              | eval command=mvjoin(data," OR ") 
              | eval command="\"".command."\"" 
              | return $command ]
            | eval search="index=\"".index."\" sourcetype=\"".sourcetype."\" ".filter." earliest=".earliest_epoch." latest=".latest_epoch 
            | fields search index  count earliest latest</query>
          <earliest>$timerange.earliest$</earliest>
          <latest>$timerange.latest$</latest>
        </search>
        <option name="count">25</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <link target="_blank">search?q=$click.value$&amp;earliest=$timerange.earliest$&amp;latest=$timerange.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>